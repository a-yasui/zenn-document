---
title: "Laravel 9 Upgrade Memo"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['laravel']
published: true
---

Laravel9ãŒ2022/02/08ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã§ã€æ–°æ©Ÿèƒ½ãŠã‚ˆã³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¡ãƒ¢ã€‚Deepl ã ã£ãŸã‚Šæ„è¨³ã ã£ãŸã‚Šã™ã‚‹ã®ã§ã€æœ¬å®¶æœ¬å…ƒã‚’èª­ã‚“ã§ãã ã•ã„ãªã€‚

~å‰å›ã® LTS ãŒ Laravel 6ï¼ˆ2019/09/03 Releaseï¼‰ãªã®ã§ã€ãã‚Œã‹ã‚‰ä¹…ã—ã¶ã‚Šã® LTSã§ã™ã€‚~

- 2022/02/10 15:13:00 : LTS å¤–ã‚Œã¦ãŸã€‚ç†ç”±ã‚ã‹ã‚‰ã‚“ã‘ã© Symfony6 ã® PHP Minimum Version ãŒ 8.1+ ã«ãªã‚Šãã†ã ã‹ã‚‰ã£ã½ã„ï¼Ÿ https://github.com/symfony/symfony/pull/45377

ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹PHPãŒ 8.0ã€œ8.1ï¼ˆç¾åœ¨ã®æ‰€ã€‚ãŠãã‚‰ã8ç³»ã¯ã‚µãƒãƒ¼ãƒˆï¼Ÿï¼‰ã¨ãªã£ã¦ãŠã‚Šã€7.x ç³»ã¯å‹•ãã¾ã›ã‚“ã€‚ã“ã‚Œã«ã¨ã‚‚ãªã„ [named arguments -- www.php.net](https://www.php.net/manual/en/functions.arguments.php#functions.named-arguments) ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚


ãƒã‚°ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯ 2024/02/08ã¾ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯ 2025/02/08 ã¾ã§ã§ã™ã€‚


ã‚ã‚Šã¨ã‚¯ã‚½ãƒ‡ã‚«å¤‰æ›´ã§ã™ã®ã§ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯æ³¨æ„ã§ã™ã€‚ PHP7â†’PHP8 ã§è¿”ã‚Šå€¤ãŒè¿½åŠ ã¨ã‹ã€SymfonyMail ã¸å¤‰æ›´ã¨ã‹ã€ FlySystem3.x ã¸å¯¾å¿œã¨ã‹ã€‚

- see : [Release Note : Laravel.com](https://laravel.com/docs/9.x/releases)
- see : [Upgrade Note : Laravel.com](https://laravel.com/docs/9.x/upgrade)

# å¤‰æ›´ç‚¹

å¤šã„ã®ã§ã€å³å´ã®ä¸€è¦§ã‚’è¦‹ã¦ãã ã•ã„ã€‚

## å¤‰æ›´é‡ãŒç‰¹ã«å¤§ãã„ã‚‚ã®

1. PHP8.0 ä»¥ä¸ŠãŒå¿…é ˆã€PHP8.1ä»¥ä¸ŠãŒæ¨å¥¨ã€ã«ãªã‚Šã¾ã—ãŸã€‚PHP8.1ä»¥ä¸ŠãŒæ¨å¥¨ãªã®ã¯ Enum ã‚’ä½¿ãˆãŸã»ã†ãŒè‰¯ã„ã‹ã‚‰ã§ã™ã€‚
2. SwiftMailer ã®ä½¿ç”¨ãŒçµ‚ã‚ã‚Šã€SymfonyMail ã¸å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ãã‚Œã®å¯¾å¿œã™ã‚‹å¤‰æ›´ãŒå¤§å¹…ã«ã‚ã‚Šã¾ã™ã€‚
3. AWS S3 ç­‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã FlySystem ã®åˆ©ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ 3.0 ç³»ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã«å¯¾å¿œã™ã‚‹å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚

# ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ–¹æ³•

composer.json ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

- å¤‰æ›´: `laravel/framework:^9.0`
- å¤‰æ›´: `nunomaduro/collision:^6.0`
- è¿½åŠ : `facade/ignition`
- è¿½åŠ : `spatie/laravel-ignition": "^1.0"`

ã•ã‚‰ã« Notification ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚‚ã‚ã‚Šã¾ã™ã®ã§ã€å„è‡ªé ‘å¼µã£ã¦ãã ã•ã„ã€‚


## [NEW][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜]  PHP8.0

PHP 8.0.2 ä»¥ä¸ŠãŒæ¨å¥¨ã§ã™ã€‚ãŸã ã€Enumä½¿ã†ãŸã‚ã« PHP8.1ä»¥ä¸ŠãŒè‰¯ã„ã‹ã‚‚ã€‚

see : https://laravel.com/docs/9.x/upgrade#updating-dependencies

### Return Type

PHP Methods ã® `offsetGet`,`offsetSet` ã®è¿”ã‚Šå€¤ãŒä»˜ãã¾ã—ãŸã€‚ã‚´ãƒªã‚´ãƒªæ›¸ã„ã¦è¡Œãã¾ã—ã‚‡ã†ã€‚

# Application

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The Application Contract

`Illuminate\Contracts\Foundation\Application` ã‚¯ãƒ©ã‚¹ã® `storagePath` ã« `$path` å¼•æ•°ãŒä»˜ãã¾ã—ãŸã€‚ç¶™æ‰¿ã—ã¦ä½¿ã£ã¦ã„ã‚‹æ™‚ã¯ `public function storagePath($path = '');` çš„ã«ã—ã¾ã—ã‚‡ã†ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½]  Exception Handler ignore Method

åŒã˜ã‚¯ãƒ©ã‚¹ã® `ignore` ãƒ¡ã‚½ãƒƒãƒ‰ãŒ `public` ã«ãªã‚Šã¾ã—ãŸã®ã§ã€è¿½å¾“å¤‰æ›´ã‚’ã—ã¦ãã ã•ã„ã€‚


# Blade

## [è¿½åŠ ] Rendering Inline Blade Templates

see : https://laravel.com/docs/9.x/releases#rendering-inline-blade-templates

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒãªãã¦ã‚‚ Blade ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```php
use Illuminate\Support\Facades\Blade;
 
return Blade::render('Hello, {{ $name }}', ['name' => 'Julian Bashir']);
```

## [è¿½åŠ ] Slot Name Shortcut

`x-slot` ã‚¿ã‚°ã« `<x-slot name="title">` ã¨ã—ã¦ãŸã¨ã“ã‚ã‚’ `<x-slot:title>` ã¨ã„ã†æ„Ÿã˜ã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## [è¿½åŠ ] Checked / Selected Blade Directives

https://laravel.com/docs/9.x/releases#checked-selected-blade-directives

`@checked` ãŠã‚ˆã³ `@selected` ã‚¿ã‚°ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ï¼ˆä¸‰é …æ¼”ç®—å­ã§ãˆãˆã‚„ã‚“ã‘ï¼‰

```html
<input type="checkbox"
        name="active"
        value="active"
        @checked(old('active', $user->active)) />

<select name="version">
    @foreach ($product->versions as $version)
        <option value="{{ $version }}" @selected(old('version') == $version)>
            {{ $version }}
        </option>
    @endforeach
</select>
```

## [è¿½åŠ ] Bootstrap 5 Pagination Views

BootStrap5 ã‚’ä½¿ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã®ã§ã€ä½¿ã†æ™‚ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæ„Ÿã˜ã§ `App\Providers\AppServiceProvider` ã«æ›¸ãè¾¼ã‚“ã§ãã ã•ã„ã€‚

```php
use Illuminate\Pagination\Paginator;
 
/**
 * Bootstrap any application services.
 *
 * @return void
 */
public function boot()
{
    Paginator::useBootstrapFive();
}
```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] Lazy Collections & The $loop Variable

ãƒ«ãƒ¼ãƒ—ã‚’ã—ã¦ã„ã‚‹ã¨ãã€`$loop` ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ Lazy Collections å…¨ä½“ãŒãƒ¡ãƒ¢ãƒªãƒ¼ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã®ã§ã€Lazy Collectionsã®ä½¿ç”¨ãŒç„¡æ„å‘³ã«ãªã‚Šã¾ã™ã€‚

# Collections

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The Enumerable Contract

1. `Illuminate\Support\Enumerable` ã‚¯ãƒ©ã‚¹ã« `solo` ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ä½¿ç”¨ã—ã¦ã„ã‚‹æ™‚ã¯ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
2. `reduceWithKeys` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ `reduce` ãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒæ„ãªã®ã§ã€å»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚
3. `reduceMany` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ `reduceSpread` ã«åç§°ãŒå¤‰ã‚ã‚Šã¾ã—ãŸã€‚


# Container

## [å¤‰æ›´][å½±éŸ¿ã»ã¼ãªã„] The Container Contract

`Illuminate\Contracts\Container\Container` ã«ã‚ã‚‹ `scoped` ã¨ `scopedIf` ãŒæ–°ã—ãå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚ç¶™æ‰¿ã—ã¦å®Ÿè£…ã‚’ã—ã¦ã„ã‚‹å ´åˆã¯å®Ÿè£…ã‚’ã—ã¦ãã ã•ã„ã€‚

## [å¤‰æ›´][å½±éŸ¿ã»ã¼ãªã„]The ContextualBindingBuilder Contract

`Illuminate\Contracts\Container\ContextualBindingBuilder` ã« `giveConfig` ãŒæ–°ã—ãå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚ä½¿ç”¨ã—ã¦ã„ã‚‹æ™‚ã¯æ–°ã—ãå®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

# Database

## [è¿½åŠ ] Full Text

see : https://laravel.com/docs/9.x/releases#full-text

MySQL/PostgreSQL ã§ãƒ•ãƒ«ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒä»˜ãã¾ã—ãŸã€‚

```php
$table->text('bio')->fullText();
```

ä½¿ã†æ™‚ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

```php
$users = DB::table('users')
           ->whereFullText('bio', 'web developer')
           ->get();

```

## [è¿½åŠ ] Laravel Scout Database Engine

ã‚ˆãã‚ã‹ã‚“ãªã„ã‘ã©ã€ Scout ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ Eloquent ã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã£ã½ã„ã€‚

see : https://laravel.com/docs/9.x/scout

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸¦] Postgres "Schema" Configuration

PostgreSQLã‚’ä½¿ã†å ´åˆã® `config/database.php` ã«ã‚ã‚‹ã€æ¥ç¶šãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ `search_path` ã«åå‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] Schema Builder registerCustomDoctrineType Method

`Illuminate\Database\Schema\Builder` ã® `registerCustomDoctrineType` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚ä»£ã‚ã‚Šã« `registerDoctrineType` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã‹ã€ `config/database.php` ã«ã‚«ã‚¹ã‚¿ãƒ ã® Doctrine ã‚¿ã‚¤ãƒ—ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚

# Eloquent

## [è¿½åŠ ] Improved Eloquent Accessors / Mutators

ä»Šã¾ã§ Mutators ã¨ã—ã¦ `getHogeAttribute/setHogeAttribute` ã¨ãªã£ã¦ã„ã¾ã—ãŸãŒã€ã‚‚ã£ã¨æ¥½ã«ãªã‚Šã¾ã™ã€‚

```php
use Illuminate\Database\Eloquent\Casts\Attribute;
 
public function name(): Attribute
{
    return new Attribute(
        get: fn ($value) => strtoupper($value),
        set: fn ($value) => $value,
    );
}

```

ã•ã‚‰ã« `Illuminate\Database\Eloquent\Casts\Attribute` ã‚’ç¶™æ‰¿ã—ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```php
use App\Support\Address;
use Illuminate\Database\Eloquent\Casts\Attribute;
 
public function address(): Attribute
{
    return new Attribute(
        get: fn ($value, $attributes) => new Address(
            $attributes['address_line_one'],
            $attributes['address_line_two'],
        ),
        set: fn (Address $value) => [
            'address_line_one' => $value->lineOne,
            'address_line_two' => $value->lineTwo,
        ],
    );
}

```

## [è¿½åŠ ] Enum Eloquent Attribute Casting

Enumã‚’ä½¿ã£ã¦ cast ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚PHP8.1+ã®ã¿ã€‚

```php
use App\Enums\ServerStatus;
 
/**
 * The attributes that should be cast.
 *
 * @var array
 */
protected $casts = [
    'status' => ServerStatus::class,
];

```

enum Cast ã‚’ä½¿ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```php
if ($server->status == ServerStatus::provisioned) {
    $server->status = ServerStatus::ready;
 
    $server->save();
}

```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸¦] Custom Casts & null

DEEPL: Laravelã®ä»¥å‰ã®ãƒªãƒªãƒ¼ã‚¹ã§ã¯ã€ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®setãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚­ãƒ£ã‚¹ãƒˆå±æ€§ãŒNULLã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å‘¼ã³å‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã—ã‹ã—ã€ã“ã®å‹•ä½œã¯Laravelã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨çŸ›ç›¾ã—ã¦ã„ã¾ã—ãŸã€‚Laravel 9.xã§ã¯ã€ã‚­ãƒ£ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®setãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€æä¾›ã•ã‚ŒãŸ$valueå¼•æ•°ã¨ã—ã¦nullã§å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ã‚¹ãƒˆãŒã“ã®ã‚·ãƒŠãƒªã‚ªã‚’ååˆ†ã«å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```php
/**
 * Prepare the given value for storage.
 *
 * @param  \Illuminate\Database\Eloquent\Model  $model
 * @param  string  $key
 * @param  AddressModel  $value
 * @param  array  $attributes
 * @return array
 */
public function set($model, $key, $value, $attributes)
{
    if (! $value instanceof AddressModel) {
        throw new InvalidArgumentException('The given value is not an Address instance.');
    }
 
    return [
        'address_line_one' => $value->lineOne,
        'address_line_two' => $value->lineTwo,
    ];
}
```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸¦] Belongs To Many firstOrNew, firstOrCreate, and updateOrCreate Methods

ã‚ˆãã‚ã‹ã‚“ãªã„ã€‚å¤šå¯¾å¤šé–¢é€£ã§ã¤ã‹ã†ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ‰±ã„ã«å¯¾ã—ã¦å¤‰æ›´ãŒã‚ã‚‹ã¿ãŸã„ï¼Ÿ

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The touch Method

`touch` ãƒ¡ã‚½ãƒƒãƒ‰ã«å¼•æ•° `$attribute` ãŒä»˜ãã¾ã—ãŸã®ã§ã€è¿½å¾“å¤‰æ›´ã‚’ã—ã¦ãã ã•ã„ã€‚


# Encryption

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The Encrypter Contract

`Illuminate\Contracts\Encryption\Encrypter` ã‚¯ãƒ©ã‚¹ã« `getKey` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸã®ã§ã€å®Ÿè£…ã‚’ã—ã¦ã„ã‚‹å ´åˆã¯è¿½å¾“å¤‰æ›´ã‚’ã—ã¦ãã ã•ã„ã€‚

# Facades

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The getFacadeAccessor Method

`getFacadeAccessor` ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”ã‚Šå€¤ãŒã¯å¸¸ã«ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã® Binding Key ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚ä»¥å‰ã®ãƒªãƒªãƒ¼ã‚¹ã¾ã§ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã—ãŸãŒã€è¿‘ã„ã†ã¡ã«å»ƒæ­¢ã•ã‚Œã¾ã™ã®ã§ã€ã‚¯ãƒ©ã‚¹ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

```php
/**
 * Get the registered name of the component.
 *
 * @return string
 */
protected static function getFacadeAccessor()
{
    return Example::class;
}

```


# FlySystem

FlySystem ã‚’ 3.x ç³»ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚

see : https://laravel.com/docs/9.x/upgrade#flysystem-3

## [Upgrade][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

S3 ãªã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚

```shell
> composer require --with-all-dependencies league/flysystem-aws-s3-v3 "^3.0"
```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] put, write, writeStream ã®æŒ™å‹•å¤‰æ›´

`put, write, writeStream` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®æŒ™å‹•ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‹ã‚‰ã¯æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ä¸Šæ›¸ãã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèªã¯æ›¸ãå‡ºã™å‰ã«å®ŸåŠ¹ã‚’ã—ã¦ãã ã•ã„ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] Reading Missing Files

å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸæ™‚ã« `null` ã‚’è¿”ã—ã¦ã„ã¾ã—ãŸãŒ `Illuminate\Contracts\Filesystem\FileNotFoundException` ã®ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] Deleting Missing Files

å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ãŸæ™‚ã¯ `true` ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] Cached Adapters

FlySystem ã‹ã‚‰ `cached adapters` ã®ã‚µãƒãƒ¼ãƒˆãŒãªããªã‚Šã¾ã—ãŸã€‚ãã‚Œã«ã¨ã‚‚ãªã„ Laravel ã‚‚ã‚µãƒãƒ¼ãƒˆã—ãªããªã‚Šã¾ã™ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] Custom Filesystems

ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ã‚‹æ™‚ã«å¤‰æ›´ãŒå¿…è¦ã¿ãŸã„ã€‚

```php
// Laravel ~8
use Illuminate\Support\Facades\Storage;
use League\Flysystem\Filesystem;
use Spatie\Dropbox\Client as DropboxClient;
use Spatie\FlysystemDropbox\DropboxAdapter;
 
Storage::extend('dropbox', function ($app, $config) {
    $client = new DropboxClient(
        $config['authorization_token']
    );
 
    return new Filesystem(new DropboxAdapter($client));
});
```

```php
// Laravel 9~
use Illuminate\Filesystem\FilesystemAdapter;
use Illuminate\Support\Facades\Storage;
use League\Flysystem\Filesystem;
use Spatie\Dropbox\Client as DropboxClient;
use Spatie\FlysystemDropbox\DropboxAdapter;
 
Storage::extend('dropbox', function ($app, $config) {
    $adapter = new DropboxAdapter(new DropboxClient(
        $config['authorization_token']
    ););
 
    return new FilesystemAdapter(
        new Filesystem($adapter, $config),
        $adapter,
        $config
    );
});

```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The FILESYSTEM_DRIVER Environment Variable


`.env`ã«ã‚ã‚‹å¤‰æ•° `FILESYSTEM_DRIVER` ãŒ `FILESYSTEM_DISK` ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

ã‚‚ã—å¤‰æ›´ã—ãŸã„æ™‚ã¯å¤‰æ›´ã‚’ã—ã¦ãã ã•ã„ã€‚å¤‰æ›´ã‚’ã—ãªãã¦ã‚‚ç¾çŠ¶ã¯å•é¡Œãªã„ã¯ãšã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The "Cloud" Disk

2020/11 ã®ãƒªãƒªãƒ¼ã‚¹ã‚ˆã‚Š `cloud` Disk Configuration ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚

# HTTP Client

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] Default Timeout

Laravel ã® HTTP_Client ã«ã‚ã‚‹ default timeout ãŒ 30 ç§’ã«ãªã‚Šã¾ã—ãŸã€‚å¤‰æ›´ã‚’ã™ã‚‹å ´åˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚

```php
$response = Http::timeout(120)->get(...);
```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] HTTP Fake & Middleware

`Http::fake()` ã¨ã—ã¦ã‚‚ GuzzleMiddleware ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€ã“ã‚Œã‹ã‚‰ã¯å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] HTTP Fake & Dependency Injection

åŠ›å°½ããŸ


# Mailer

å¤§å¹…ã«ãƒ†ã‚³å…¥ã‚Œã§ã™ã€‚

## [NEW][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆé«˜] Symfony Mailer

SwiftMailerãŒä½¿ã‚ã‚Œã¦ã„ã¾ã—ãŸãŒã€2021/12ã‹ã‚‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒã•ã‚Œã¦ã„ãªã„ã®ã§ã€SymfonyMailerã«ä¹—ã‚Šæ›ãˆã¾ã—ãŸã€‚

ã“ã‚Œã«ã¨ã‚‚ãªã„ã€ãŸãã•ã‚“ã®å¤‰æ›´ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆç™½ç›®ï¼‰

see : [Upgrade : Symfony Mailer -- laravel.com](https://laravel.com/docs/9.x/upgrade#symfony-mailer)

### ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ã—ã¦ã®å‰ææ¡ä»¶

mailgun ã‚„ postmark ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ãã‚Œãã‚Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shell
> composer require symfony/mailgun-mailer
```

```shell
> composer require symfony/sendgrid
```

### send/html/text/plain ã®è¿”ã‚Šå€¤ã®å¤‰æ›´

ä»Šã¾ã§é€ä¿¡æ•°ã‚’è¿”ã—ã¦ã„ãŸã®ãŒ `Illuminate\Mail\SentMessage`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ `Symfony\Component\Mailer\SentMessage` ã®ç¶™æ‰¿ã‚¯ãƒ©ã‚¹ã§ `getSymfonySentMessage`ã§å‹•çš„ã«ä½œæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ãã¾ã™ã€‚

### Rename `Swift` to `Symfony`

Laravel 8 ã®é ƒã¨ 9 ã«ãªã£ã¦ã‹ã‚‰ã§ã¯ã€ãƒ¡ã‚½ãƒƒãƒ‰åãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™ã€‚

```php
// Laravel 8.x...
$this->withSwiftMessage(function ($message) {
    $message->getHeaders()->addTextHeader(
        'Custom-Header', 'Header Value'
    );
});
 
// Laravel 9.x...
use Symfony\Component\Mime\Email;
 
$this->withSymfonyMessage(function (Email $message) {
    $message->getHeaders()->addTextHeader(
        'Custom-Header', 'Header Value'
    );
});
```

`Email` ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ [Symfony Mailer -- symfony.com](https://symfony.com/doc/current/mailer.html#creating-sending-messages) ã§ç¢ºèªã§ãã¾ã™ã€‚

#### Proxied `Illuminate\Mail\Message` methods

`Illuminate\Mail\Message` ã¯å­˜åœ¨ã—ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã¯ `Swift_Message` ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã—ãŸã€‚ã—ãŸãŒã£ã¦ã€å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ `Symfony\Component\Mime\Email` ã«å¤‰æ›´ã™ã‚‹å¿…è¦ã‚ã‚Šã¾ã™ã€‚

```php
// Laravel 8.x...
$message
    ->setFrom('taylor@laravel.com')
    ->setTo('example@example.org')
    ->setSubject('Order Shipped')
    ->setBody('<h1>HTML</h1>', 'text/html')
    ->addPart('Plain Text', 'text/plain');
 
// Laravel 9.x...
$message
    ->from('taylor@laravel.com')
    ->to('example@example.org')
    ->subject('Order Shipped')
    ->html('<h1>HTML</h1>')
    ->text('Plain Text');
```

#### Generated Messages IDs

ã‚ˆãã‚ã‹ã‚‰ã‚“

#### Forced Reconnections

ã‚ˆãã‚ã‹ã‚‰ã‚“ã€‚

ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ™‚ã®æ¥ç¶šã«å¤±æ•—ã—ãŸæ™‚ã«å†æ¥ç¶šã‚’ã™ã‚‹ãŒã€ãã‚Œã‚‚å¤±æ•—ã—ãŸæ™‚ã¯ä¾‹å¤–ã‚’æŠ•ã’ã¦çµ‚ã‚ã‚‹æ„Ÿã˜ï¼Ÿ

#### SMTP Stream Options

SMTP ã® stream ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚ä»£ã‚ã‚Šã«ç›´æ¥ã«å®šç¾©ã‚’ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã®è¨­å®šã¯ [Symfony ã® Transport Setup](https://symfony.com/doc/current/mailer.html#transport-setup)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚


```php
'smtp' => [
    // Laravel 8.x...
    'stream' => [
        'ssl' => [
            'verify_peer' => false,
        ],
    ],
 
    // Laravel 9.x...
    'verify_peer' => false,
],
```

#### SMTP `auth_mode`

mail è¨­å®šã® `auth_mode` ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚

#### Failed Recipients

ãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡å¾Œã«å¤±æ•—ã—ãŸå—ä¿¡è€…ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ããªããªã‚Šã¾ã—ãŸï¼ˆãˆã€ã§ããŸã®ï¼Ÿï¼‰

ä»£ã‚ã‚Šã«é€ä¿¡ã«å¤±æ•—ã™ã‚‹ã¨ `Symfony\Component\Mailer\Exception\TransportExceptionInterface` ã®ä¾‹å¤–ã‚’æ”¾ã¤ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¤œè¨¼ã¯é€ä¿¡å‰ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

# Packages

https://laravel.com/docs/9.x/upgrade#the-lang-directory

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] The lang Directory

`resources/lang` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ãŒ `app()->langPath()` ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

# queue

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] The opis/closure Library

https://laravel.com/docs/9.x/upgrade#the-opis-closure-library

`opis/closure` ã‚’ä½¿ã‚ãš `laravel/serializable-closure` ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã¨ã‚‚ãªã„ `Illuminate\Queue\SerializableClosureFactory` ã¨ `Illuminate\Queue\SerializableClosure` ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚

ã‚‚ã—ä½¿ç”¨ã—ç¶šã‘ã‚‹å ´åˆã¯ https://github.com/laravel/serializable-closure ã‚’å€‹åˆ¥ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] The Failed Job Provider flush Method

`flush` ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã¯ `Illuminate\Queue\Failed\FailedJobProviderInterface` ã«ã‚ã‚Šã¾ã™ãŒã€`$hour` å¼•æ•°ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ãã‚Œã¯ã€ã©ã‚Œã ã‘å¤ã„å¤±æ•—ã—ãŸJobã‹ã‚’å›³ã‚‹ï¼ˆå˜ä½ã¯æ™‚é–“ï¼‰ã®ã«ä½¿ã†ã¿ãŸã„ã§ã™ï¼Ÿ

# Session

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä½] The getSession Method

åŠ›å°½ããŸã€‚

# Routing

Routing ã«è‰²ã€…ã¨æ©Ÿèƒ½ãŒå¢—ãˆã¾ã—ãŸã€‚

## [NEW] Implicit Route Bindings With Enums

see : https://laravel.com/docs/9.x/releases#implicit-route-bindings-with-enums

PHP8.1+ ã‹ã‚‰ Enum ãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚ãã‚Œã«åˆã‚ã›ã¦ã€Laravel9 ã‚‚ Routing ã« Enum ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```php
enum Category: string
{
    case Fruits = 'fruits';
    case People = 'people';
}

Route::get('/categories/{category}', function (Category $category) {
    return $category->value;
});

```


## [NEW] Forced Scoping Of Route Bindings

see : https://laravel.com/docs/9.x/releases#forced-scoping-of-route-bindings

ã‚ˆãã‚ã‹ã‚“ãªã„

## [NEW] Controller Route Groups

Controller ã®æŒ‡å®šã‚’ `controller` ãƒ¡ã‚½ãƒƒãƒ‰ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```php
Route::controller(\App\Http\Controllers\OrderController::class)->group(function () {
    Route::get('/orders/{id}', 'show');
    Route::post('/orders', 'store');
});

```

## [NEW] Improved route:list CLI Output

https://laravel.com/docs/9.x/releases#improved-route-list

`route:list` ã®å‡ºåŠ›ãŒäººé“çš„ã«ãªã‚Šã¾ã—ãŸã€‚


# Exception Page

https://laravel.com/docs/9.x/releases#exception-page

ä½•ã‹é–‹ç™ºä¸­ã«å‡ºã‚‹ä¾‹å¤–ã‚¨ãƒ©ãƒ¼ã®ç”»é¢ãŒãƒªãƒƒãƒã«ãªã£ãŸã£ã½ã„ã€‚


# Test

## [NEW] Test Coverage Using Artisan test Command

https://laravel.com/docs/9.x/releases#test-coverage-support-on-artisan-test-Command

Coverage ã®å‡ºåŠ›ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã—ãŸã€‚ãã—ã¦ `--min` ã‚’ã¤ã‘ã‚‹ã¨ã€Coverage ã®æ•·å±…ã¨ã—ã¦è¨­å®šã—ã¦ã€Coverage ã®çµæœãŒ `min` ã§æŒ‡å®šã—ãŸå€¤ã‚ˆã‚Šä½ã„æ™‚ã¯ã‚¨ãƒ©ãƒ¼ã‚’èµ·ã“ã™ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] The assertDeleted Method

å…¨ã¦ã® `assertDeleted` ã¯ `assertModelMissing` ãŒå‘¼ã°ã‚Œã¾ã™ã€‚

# Trusted Proxies

ã‚ˆãã‚ã‹ã‚“ãªã„.


`use Fideloper\Proxy\TrustProxies as Middleware` ã‚’ `use Illuminate\Http\Middleware\TrustProxies as Middleware` ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã£ã½ã„ã€‚



# Validator

## [è¿½åŠ ] Improved Validation Of Nested Array Data

https://laravel.com/docs/9.x/releases#improved-validation-of-nested-array-data

é…åˆ—ã§æ¥ãŸãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€å€‹ã€…ã®è¦ç´ ãƒã‚§ãƒƒã‚¯ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™â€¦ï¼Ÿ

```php
use App\Rules\HasPermission;
use Illuminate\Support\Facades\Validator;
use Illuminate\Validation\Rule;
 
$validator = Validator::make($request->all(), [
    'companies.*.id' => Rule::forEach(function ($value, $attribute) {
        return [
            Rule::exists(Company::class, 'id'),
            new HasPermission('manage-company', $value),
        ];
    }),
]);
```

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] Form Request validated Method

`validated` ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ãŒå¤‰æ›´ã•ã‚ŒãŸã¿ãŸã„ã§ã™ã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] The password Rule

ç¾åœ¨ç™»éŒ²ã—ã¦ã„ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨èªè¨¼ã‚’ã™ã‚‹ã®ã« `current_password` ãƒ¡ã‚½ãƒƒãƒ‰ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] Unvalidated Array Keys

https://laravel.com/docs/9.x/upgrade#unvalidated-array-keys

ã‚ˆãã‚ã‹ã‚“ãªã„


# IDE Support

## [NEW] Improved Collections IDE Support

https://laravel.com/docs/9.x/releases#improved-collections-ide-support

IDE-Helper ã¨ã©ã†é•ã†ã®ã‹ã‚ã‹ã‚‰ãªã„ã‘ã©ã€å…¬å¼ã¨ã—ã¦IDE/PHPStanã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

# Helper

https://laravel.com/docs/9.x/releases#new-helpers

## `str`

`str` ã®è¿”ã‚Šå€¤ãŒ `Illuminate\Support\Stringable` ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## `to_route`

`to_route` ã§ã„ã‚ã„ã‚â€¦â€¦ï¼Ÿ

## [å¤‰æ›´][ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¸­] The when / unless Methods

https://laravel.com/docs/9.x/upgrade#when-and-unless-methods


`when/unless` ãƒ¡ã‚½ãƒƒãƒ‰ã«å¤‰æ›´ãŒã‚ã£ãŸã¿ãŸã„ã€‚ä½¿ã£ãŸã“ã¨ãŒãªã„ã‹ã‚‰ã‚ã‹ã‚‰ãªã„â€¦

