---
title: "Carbonã® subMonth ã¨ subMonthsWithOverflow ã¨ã‹"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['php','laravel']
published: True
---

ãƒ†ã‚¹ãƒˆã‚’å›ã—ã¦ã„ã‚‹æ™‚ã«ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å…ˆæœˆã®æƒ…å ±ã‚’å…¥ã‚Œã‚‹ã¯ãšãŒä»Šæœˆã®æƒ…å ±ã‚’å…¥ã‚Œã¦ã—ã¾ã„ãƒ†ã‚¹ãƒˆãŒã‚³ã‚±ã‚‹ã¨ã„ã†äº‹ãŒèµ·ããŸã®ã§ãƒ¡ãƒ¢ã€‚

ä½¿ç”¨ã—ã¦ã„ã‚‹ Carbon ã¯ ^2.0 ã§ã™ã€‚

## SubMonths ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã„ã†ç‰©

å…ˆæœˆã‚„æ•°ãƒ¶æœˆå‰ã®æ—¥ä»˜ã‚’å–ã‚Šå‡ºã™ã®ã«ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ãŸã ã€Carbonã«ã¯ `subMonths` ãƒ¡ã‚½ãƒƒãƒ‰ä»¥å¤–ã«ã‚‚ `subMonthsWithOverflow`, `subMonthsWithoutOverflow`, `subMonthsWithNoOverflow`, `subMonthsNoOverflow` ã¨ã‚ã‚Šã¾ã™ã€‚

èª¬æ˜æ–‡ã«ã¯ã€Œoverflow explicitly forbiddenã€ã‚„ã€Œoverflow explicitly allowedã€ã¨è¨€ã£ãŸåŒºåˆ¥ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãš **2021/03/29** ã®ä¸€ãƒ¶æœˆå‰ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```shell
>>> \Carbon\Carbon::create( 2021, 3, 29, 1 )->subMonths(1)
=> Carbon\Carbon @1614528000 {#3827
     date: 2021-03-01 01:00:00.0 Asia/Tokyo (+09:00),
   }
>>> \Carbon\Carbon::create( 2021, 3, 29, 1 )->subMonthsWithOverflow(1)
=> Carbon\Carbon @1614528000 {#3856
     date: 2021-03-01 01:00:00.0 Asia/Tokyo (+09:00),
   }
>>> \Carbon\Carbon::create( 2021, 3, 29, 1 )->subMonthsWithoutOverflow(1)
=> Carbon\Carbon @1614441600 {#3860
     date: 2021-02-28 01:00:00.0 Asia/Tokyo (+09:00),
   }
>>> \Carbon\Carbon::create( 2021, 3, 29, 1 )->subMonthsWithNoOverflow(1)
=> Carbon\Carbon @1614441600 {#3858
     date: 2021-02-28 01:00:00.0 Asia/Tokyo (+09:00),
   }
>>> \Carbon\Carbon::create( 2021, 3, 29, 1 )->subMonthsNoOverflow(1)
=> Carbon\Carbon @1614441600 {#3861
     date: 2021-02-28 01:00:00.0 Asia/Tokyo (+09:00),
   }
```

ä¸€ãƒ¶æœˆå‰ã‚’å–ã‚‹ãªã‚‰ `subMonthsWithoutOverflow` ã§ã„ã„ã˜ã‚ƒã‚“ã£ã¦è¨€ã†æ„Ÿã˜ã§ã™ãŒã€ã„ãã¤ã‹ç–‘å•ãŒå‡ºã¾ã™ã€‚

1. å†…éƒ¨ï¼ˆPHPï¼‰ã§ã¯ -30 æ—¥ã—ã¦ã‚‹ã¿ãŸã„ã ã‘ã©ä½•ã§ 3/1 ã‚„ 2/28 ã¨ãƒ–ãƒ¬ãŒå‡ºã‚‹ï¼Ÿ
2. `subMonthsWithOverflow`, `subMonthsWithoutOverflow`,`subMonthsWithNoOverflow`,`subMonthsNoOverflow` ã®ãã‚Œãã‚Œã®é•ã„ã¯ä½•ï¼Ÿ


## å†…éƒ¨ï¼ˆPHPï¼‰ã§ã¯ -30 æ—¥ã—ã¦ã‚‹ã¿ãŸã„ã ã‘ã©ä½•ã§ 3/1 ã‚„ 2/28 ã¨ãƒ–ãƒ¬ãŒå‡ºã‚‹ï¼Ÿ

Carbon ã¯åŸºæœ¬çš„ã«ã¯ PHP ã® `\DateTime` ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ç‰©ã§ã™ã€‚ãã—ã¦ç‹¬è‡ªãƒ¡ã‚½ãƒƒãƒ‰ã® `subMonths` ç­‰ã¯ `Carbon\Traits\Date` ã¨ã‹ã§ã‚´ãƒªã‚´ãƒªå®Ÿè£…ã—ã¦ã„ã‚‹æ„Ÿã˜ã€‚ 

ã§ä¸€ãƒ¶æœˆå‰ã®è§£é‡ˆé•ã„ã§ã€ä¾‹ãˆã° **3/10 ã®ä¸€ãƒ¶æœˆå‰ã¯ 2/10** ã¨ã—ãŸã‚‰ã€ **3/30 ã®ä¸€ãƒ¶æœˆå‰ã¯ 2/30 ã«ã¯ãªã‚‰ãªã„ã®ã§ç¿Œæœˆã® 3/2** ã«ã™ã‚‹ã€ã¨ã„ã†è§£é‡ˆã«ãªã‚‹ã€‚ã“ã®ç¿Œæœˆã«æŒã¡è¶Šã™ã®ã‚’ overflow ã¨è¨€ã£ã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã€‚ã“ã‚Œã¯å¹´åº¦ã«ã‚‚è¨€ãˆã¦ã€ã†ã‚‹ã†å¹´ãªã©ã«é–¢ä¿‚ã—ã¦ãã¾ã™ã€‚


## `subMonthsWithOverflow`,`subMonthsWithoutOverflow`,`subMonthsWithNoOverflow`,`subMonthsNoOverflow` ã®ãã‚Œãã‚Œã®é•ã„ã¯ä½•ï¼Ÿ

overflow ã‚’ã™ã‚‹ã—ãªã„ã‹ã®é•ã„ãªã®ã§ã™ãŒã€ãªãœã« `Without` ã‚„ `WithNo` ã‚„ `No` ãŒå¢—ãˆãŸã¨ã„ã†ã‚¢ãƒ¬ã€‚ã‚ã¨ä¹…ã€…ã«è¦‹ãŸã‚‰ãˆã‚‰ã„è¦‹ã«ãããªã£ã¦ãŸã®ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è¿½ã£ã‹ã‘ãƒ¡ãƒ¢æ›¸ãã€‚

[ã“ã“ã‚‰ã¸ã‚“ -- github](https://github.com/briannesbitt/Carbon/blob/master/src/Carbon/Traits/Date.php#L2526-L2541) ã‚’ã¿ã‚Œã°å¤§ä½“ã‚ã‹ã‚Šã¾ã™ã€‚

è¦‹ãŸé™ã‚Š `Month|Quarter|Year|Decade|Century|Centurie|Millennium|Millennia` ã¨ `No|With|Without|WithNo` ã®ï¼’ç¨®é¡ã«åˆ†ã‘ã¦ã€å¾ŒåŠã® `Overflow` ã«é–¢ã—ã¦ã¯ `With` ã‚’ä»˜ã‘ã‚‹ã‹ä»˜ã‘ãªã„ã‹ã®ã¿ã®é•ã„ã¿ãŸã„ã§ã™ã€‚

ãã—ã¦å®Ÿéš›ã®å‡¦ç†ã¯ `$this->{"${action}Unit"}($unit, $parameters[0] ?? 1, $overflow);` ã¨ã„ã£ãŸæ„Ÿã˜ã§ã™ã”ã„æŠ•ã’æ–¹ã—ã¦ã¾ã™ã€‚ `subMonthsWithOverflow` ã§å±•é–‹ã™ã‚‹ã¨ `$action = 'sub'; $unit = 'Month'; $parameters  = []; $overflow = true;` ã«ãªã£ã¦ `subUnit('Month', 1, true);` ã¨ã„ã£ãŸæ„Ÿã˜ã«ãªã‚‹ã¯ãšã€‚
ãã‚“ãªã‚ã‘ã§ [Units::subUnit ã«é£›ã¶ã®ã§ã™](https://github.com/briannesbitt/Carbon/blob/master/src/Carbon/Traits/Units.php#L325-L328) ãŒå˜ç´”ã«æ•°å€¤ã‚’è² ã«ã™ã‚‹ã ã‘ã®ã‚ˆã†ã§ã€çµå±€ã¯ [Units::addUnit](https://github.com/briannesbitt/Carbon/blob/master/src/Carbon/Traits/Units.php#L230) ãŒå‡¦ç†ã‚’ã—ã¾ã™ã€‚

ã™ã¹ã¦ã® add/sub å‡¦ç†ã¯ [Units::addUnit ã§ Datetime::modify](https://github.com/briannesbitt/Carbon/blob/master/src/Carbon/Traits/Units.php#L303) ã§å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã— [Units::addUnit ã®æœ«å°¾ã®æ–¹ã§ overflow è¨­å®šã‚’ã—ã¦ã„ã‚‹å ´åˆã¯å…ˆæœˆæœ«ã«æˆ»ã™](https://github.com/briannesbitt/Carbon/blob/master/src/Carbon/Traits/Units.php#L309-L311) å‡¦ç†ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ `subMonths()` ã¯ `subMonthsWithOverflow()` ã¯å‡¦ç†å†…å®¹ã¯åŒã˜ã§ã™ã€‚ãã—ã¦ `subMonthsWithoutOverflow`,`subMonthsWithNoOverflow`,`subMonthsNoOverflow` ã“ã“ã‚‰ã¯å¦å®šã®ä»•æ–¹ãŒé•ã†ã ã‘ã§ä¸­èº«ã¯åŒã˜ã§ã™ã€‚

# å‚è€ƒ

åŒã˜ãƒãƒã‚Šæ–¹ : [PHP Carbonã§æœˆã®è¶³ã—å¼•ãã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã«ã¯ã¾ã£ãŸ](https://zenn.dev/garypippi/articles/fb48b3dccaa50de167ce)

